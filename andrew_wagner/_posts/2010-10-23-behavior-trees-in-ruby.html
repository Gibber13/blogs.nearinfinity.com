---
atom_id: tag:www.nearinfinity.com,2010:/blogs//7.1764 # This is for backwards compatibility do not change!
permalink: /blogs/andrew_wagner/behavior_trees_in_ruby.html
layout: blogs
title: Behavior Trees in ruby
date: 2010-10-23 18:51:50 -04:00
---
<div>In my spare time, I fancy myself a fan of AI. Mostly, this means sitting around pondering, but with some spare time today, I put together an actual working (though simple) library. I thought I would share a little about it on here. <a href="http://github.com/arwagner/rbtree">The code can be found here.</a></div><div><br /></div><div>Behavior Trees are a way of representing an algorithm as nodes in a tree. The leaf nodes actually perform actions, and nodes higher up in the tree branch depending on the environment. They are often used to model behaviors for agents in first-person games. The idea is that algorithms become very modular and composable when modeled this way.</div><div><br /></div><div>I'm going to walk through the examples in 'sample.rb' in the code repository. These examples revolve around some very simple behaviors on a list. First, we'll define a couple of actions:</div><div><br /></div><div><br /></div><div>action :pop do |e|</div><div>&nbsp;&nbsp;e.pop</div><div>end</div><div><br /></div><div>action :empty do |e|</div><div>&nbsp;&nbsp;e.empty?</div><div>end</div><div><br /></div><div>The syntax here is somewhat like rake. I played with a lot of different ideas for this, but this seemed to come out the most readable. We're creating two actions, pop, and empty. An action is a leaf node in a behavior tree, so it actually interacts with the environment. Thus, the actions take a block which takes the environment, e, and does something with it. These are the fundamental building blocks.</div><div><br /></div><div>Now let's define a <a href="http://aigamedev.com/hierarchical-logic/sequence/">sequence node</a>. A sequence node is a non-leaf node, which tries each of its children, and fails if any of the children fail. Very simple. So let's define it:</div><div><br /></div><div>sequence :pop_twice, &nbsp;[:pop, :pop]</div><div><br /></div><div><br /></div><div>Simple idea, simple syntax! The name of this node is 'pop_twice', and it contains two children, both of which are leaf nodes, and which pop one element off of the list that we're interacting with. Since the first child will succeed (assuming the list is non-empty), the second will always run.&nbsp;</div><div><br /></div><div>Next, let's do a <a href="http://aigamedev.com/hierarchical-logic/selector/">selector node</a>. A selector node is another type of non-leaf node, which tries each of its children, but returns true if any child node returns true (and then stops looking). You can see, it's sort of the opposite of a sequence in some ways. So, what might it look like? Well, it could look exactly the same as a sequence!</div><div><br /></div><div>select :pop_once, [:pop, :pop]</div><div><br /></div><div>This selector has the same children, but notice that the name is pop_once. This is because...drumroll please...it will only pop one item. When the first succeeds, which it will, it is satisfied, and returns true.</div><div><br /></div><div>Now, lets look at the last two together:</div><div><br /></div><div>select :make_empty, [:empty, :continue]</div><div>sequence :continue, [:pop, :make_empty]</div><div><br /></div><div>This is the culmination of what this little library can do. Isn't it impressive!? Here, we have two nodes which are defined in terms of each other. make_empty first checks wither the list is empty. If so, then, since it's a selector, it's satisfied, and execution stops. If not, however, it hits the second node, which is continue. Continue pops an item off the stak, and then _recursively_ refers to make_empty. So, what's this going to do? It will keep popping items off the list, until it's empty. Very simple, but a very powerful idea.&nbsp;</div><div><br /></div><div>And that's about it for now! Hopefully, I will soon add the ability to define <a href="http://aigamedev.com/hierarchical-logic/decorator/">custom decorators</a> in the library. Until then, enjoy!</div>  
