---
atom_id: tag:www.nearinfinity.com,2010:/blogs//7.1724 # This is for backwards compatibility do not change!
permalink: /blogs/lee_richardson/aspajax_4_templates_part_4_-_j.html
layout: blogs
title: ASP.AJAX 4 Templates Part 4 - jQuery, and Manual JSON Object Manipulation
date: 2010-04-10 14:03:06 -04:00
tags: .NET
---
<p>This is part 4 of a multi-part series exploring building client side AJAX applications with ASP.Net AJAX 4 Templating and the WCF Data Services (aka ADO.Net Data Services, aka oData, aka Astoria) in SharePoint 2010.</p>

<div style='float:right; margin-left:10px;'>
<script type='text/javascript'>
        var currentPageUrl = 'http://rapidapplicationdevelopment.blogspot.com/2010/04/aspajax-4-templates-part-4-jquery-and.html';
 
        /* Digg */
        var diggIframe = document.createElement('iframe');
        diggIframe.setAttribute('src', 'http://digg.com/tools/diggthis.php?u=' + currentPageUrl);
        diggIframe.setAttribute('height', '80');
        diggIframe.setAttribute('width', '52');
        diggIframe.setAttribute('frameborder', '0');
        diggIframe.setAttribute('scrolling', 'no');
        diggIframe.setAttribute('style', 'margin-left:auto; margin-right:auto; display:block; text-align:center;');
 
        /* DotNetKicks */
        var dotnetkicksLink = document.createElement('a');
        dotnetkicksLink.setAttribute('href', 'http://www.dotnetkicks.com/kick/?url=' + currentPageUrl);
        var dotnetkicksImg = document.createElement('img');
        dotnetkicksImg.setAttribute('src', 'http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=' + currentPageUrl);
        dotnetkicksImg.setAttribute('alt', 'Kick this article (a good thing) on DotNetKicks');
        dotnetkicksImg.setAttribute('border', '0');
        dotnetkicksImg.setAttribute('style', 'margin-left:auto; margin-right:auto; display:block; text-align:center;');
        dotnetkicksLink.appendChild(dotnetkicksImg);
 
        var div = document.createElement('div');
        div.appendChild(dotnetkicksLink);
        div.appendChild(document.createElement('br'));
        div.appendChild(diggIframe);
 
        document.write(div.innerHTML);
    </script>
</div>

<p>
<a href="http://www.nearinfinity.com/blogs/lee_richardson/client_side_ajax_applications.html">Part 1 - Exploring WCF Data Services in SharePoint 2010</a><br />
<a href="http://www.nearinfinity.com/blogs/lee_richardson/client_side_ajax_applications_1.html">Part 2 - Creating a read-only page with ASP.Net AJAX 4.0 Templates</a><br />
<a href="http://www.nearinfinity.com/blogs/lee_richardson/client_side_ajax_applications_2.html">Part 3 - Writing data back to SharePoint with ASP.Net AJAX 4.0 Templates</a><br/>
<a href="http://www.nearinfinity.com/blogs/lee_richardson/aspajax_4_templates_part_4_-_j.html">Part 4 - jQuery and Manual JSON Object Manipulation</a>
</p>

<p>In the previous posts in this series I've shown how you can access SharePoint data using WCF Data Services, how you can display that data using ASP.Net AJAX 4.0 Templates, and how you can write data back to SharePoint.</p>

<p>In this post I'll take writing data back to SharePoint a step further by showing how you can modify non-visible fields by modifying JSON objects directly.  More specifically I'll enable dragging user story index cards on a virtual bulletin board using a jQuery plugin, save the X and Y coordinates back to JSON objects, and then save the updated records back to SharePoint. </p>

<p><b>Cards on a Corkboard</b></p>

<p>The first thing I'll do is style the cards and display them with absolute position.  While I'm at it I'll also reference the <a href=" http://jqueryui.com/demos/droppable/ ">draggable</a> jQuery UI plugin.  If you're following along at home just built a custom .js download from the jQuery UI site, drop it in your layouts directory and add a reference.  So my PageHead content control now looks like this:</p>

<p class="MsoNormal"><span style="font-size:9.5pt;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;color:blue">&lt;</span><span style="font-size:9.5pt;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;color:maroon">asp</span><span style="font-size:9.5pt;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;color:blue">:</span><span style="font-size:9.5pt;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;color:maroon">content</span><span    style="font-size:9.5pt;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas">  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">id</span><span style="color:blue">=&quot;PageHead&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">contentplaceholderid</span><span style="color:blue">=&quot;PlaceHolderAdditionalPageHead&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">runat</span><span style="color:blue">=&quot;server&quot;&gt;<br />  <br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;</span><span style="color:maroon">script</span>  <span style="color:red">type</span><span style="color:blue">=&quot;text/javascript&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">src</span><span style="color:blue">=&quot;../ajax/MicrosoftAjax.js&quot;&gt;&lt;/</span><span    style="color:maroon">script</span><span style="color:blue">&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;</span><span style="color:maroon">script</span>  <span style="color:red">type</span><span style="color:blue">=&quot;text/javascript&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">src</span><span style="color:blue">=&quot;../ajax/MicrosoftAjaxDataContext.js&quot;&gt;&lt;/</span><span    style="color:maroon">script</span><span style="color:blue">&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;</span><span style="color:maroon">script</span>  <span style="color:red">type</span><span style="color:blue">=&quot;text/javascript&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">src</span><span style="color:blue">=&quot;../ajax/MicrosoftAjaxTemplates.js&quot;&gt;&lt;/</span><span    style="color:maroon">script</span><span style="color:blue">&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;</span><span style="color:maroon">script</span>  <span style="color:red">type</span><span style="color:blue">=&quot;text/javascript&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">src</span><span style="color:blue">=&quot;../ajax/MicrosoftAjaxAdoNet.js&quot;&gt;&lt;/</span><span    style="color:maroon">script</span><span style="color:blue">&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;</span><span style="color:maroon">script</span>  <span style="color:red">type</span><span style="color:blue">=&quot;text/javascript&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">src</span><span style="color:blue">=&quot;../jquery-ui-1.8.custom/js/jquery-1.4.2.min.js&quot;&gt;&lt;/</span><span    style="color:maroon">script</span><span style="color:blue">&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;</span><span style="color:maroon">script</span>  <span style="color:red">type</span><span style="color:blue">=&quot;text/javascript&quot;</span>  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:red">src</span><span style="color:blue">=&quot;../jquery-ui-1.8.custom/js/jquery-ui-1.8.custom.min.js&quot;&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;/</span><span style="color:maroon">script</span><span    style="color:blue">&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  <span style="color:blue">&lt;</span><span style="color:maroon">style</span>  <span style="color:red">type</span><span style="color:blue">=&quot;text/css&quot;&gt;<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:maroon">.sys-template<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span>{<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">display</span>: <span style="color:blue">none</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  }<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:maroon">.userstorycard<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span>{<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">border</span>: <span style="color:blue">1px</span>  <span style="color:blue">solid</span> <span style="color:blue">#777777</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">width</span>: <span style="color:blue">200px</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">position</span>: <span style="color:blue">  absolute</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">cursor</span>: <span style="color:blue">move</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  }<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:maroon">.carddescription<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span>{<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">font-size</span>: <span style="color:blue">13px</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">background-image</span>: <span style="color:blue">  url(&#39;card_bg.jpg&#39;)</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">padding</span>: <span style="color:blue">0px</span>  <span style="color:blue">5px</span> <span style="color:blue">5px</span>  <span style="color:blue">5px</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  }<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  <span style="color:maroon">.cardtitle<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span>{<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">font-size</span>: <span style="color:blue">15px</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">font-weight</span>: <span style="color:blue">bold</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">padding</span>: <span style="color:blue">0px</span>  <span style="color:blue">0px</span> <span style="color:blue">0px</span>  <span style="color:blue">0px</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">border-bottom</span>: <span style="color:blue">  1px</span> <span style="color:blue">solid</span> <span style="color:blue">red</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">background-color</span>: <span style="color:blue">  White</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="color:red">padding</span>: <span style="color:blue">0px</span>  <span style="color:blue">5px</span> <span style="color:blue">0px</span>  <span style="color:blue">5px</span>;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>  }<br style="mso-special-character:line-break" />  <![if !supportLineBreakNewLine]>  <br style="mso-special-character:line-break" />  <![endif]><o:p></o:p></span> </p> <span style="font-size:9.5pt;line-height:115%;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA"><span style="mso-spacerun:yes"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>...</span>

<p>The next thing to do is add X and Y fields to the user story list in SharePoint.  And finally display the cards with absolute positioning:</p>

<span style="font-size:10.0pt;line-height:115%;font-family:&quot;Courier New&quot;;mso-fareast-font-family:Calibri;mso-fareast-theme-font:minor-latin;color:blue;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA;mso-no-proof:yes">&lt;</span><span style="font-size:10.0pt;line-height:115%;font-family:&quot;Courier New&quot;;mso-fareast-font-family:Calibri;mso-fareast-theme-font:minor-latin;color:#A31515;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA;mso-no-proof:yes">div</span><span style="font-size:10.0pt;line-height:115%;font-family:&quot;Courier New&quot;;mso-fareast-font-family:Calibri;mso-fareast-theme-font:minor-latin;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA;mso-no-proof:yes"> <span style="color:#A31515">xmlns</span><span     style="color:blue">:</span><span style="color:red">sys</span><span     style="color:blue">=&quot;javascript:Sys&quot;</span> <span style="color:red">class</span><span     style="color:blue">=&quot;background&quot;&gt;<br />   </span><span style="mso-spacerun:yes">&nbsp; </span><span style="color:blue">&lt;</span><span     style="color:#A31515">div</span> <span style="color:red">id</span><span     style="color:blue">=&quot;userStories&quot;</span> <span style="color:red">class</span><span     style="color:blue">=&quot;sys-template&quot;&gt;<br />   </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:blue">&lt;</span><span     style="color:#A31515">div</span> <span style="color:red">class</span><span     style="color:blue">=&quot;userStoryCard&quot;</span>   <br />   <span style="mso-spacerun:yes">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span><b     style="mso-bidi-font-weight:normal"><span style="color:#A31515">sys</span><span     style="color:blue">:</span><span style="color:red">style</span><span     style="color:blue">=&quot;</span>{{ &#39;<span style="color:red">left</span>:   <span style="color:blue">&#39; + X + &#39;px</span>; <span style="color:red">top</span>:   <span style="color:blue">&#39; + Y + &#39;px</span>;&#39;}}<span style="color:blue">&quot;&gt;<br />   <br />   </span></b><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:blue">   &lt;</span><span style="color:#A31515">div</span> <span style="color:red">class</span><span     style="color:blue">=&quot;userStoryTitle&quot;&gt;</span>{{ Title }}<span     style="color:blue">&lt;/</span><span style="color:#A31515">div</span><span     style="color:blue">&gt;<br />   </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span><span style="color:blue">&lt;</span><span     style="color:#A31515">div</span> <span style="color:red">class</span><span     style="color:blue">=&quot;userStoryBody&quot;&gt;&lt;</span><span style="color:#A31515">div</span><span     style="color:blue">&gt;</span>{{ Description }}<span style="color:blue">&lt;/</span><span     style="color:#A31515">div</span><span style="color:blue">&gt;<br />   </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:blue">&lt;/</span><span     style="color:#A31515">div</span><span style="color:blue">&gt;<br />   </span><span style="mso-spacerun:yes">&nbsp; </span><span style="color:blue">&lt;/</span><span     style="color:#A31515">div</span><span style="color:blue">&gt;<br />   &lt;/</span><span style="color:#A31515">div</span><span style="color:blue">&gt;</span></span></p>

<p>Notice the sys:style attribute.  The sys: part is the namespace you need to add for attributes when using templating that I mentioned in <a href=" http://rapidapplicationdevelopment.blogspot.com/2010/03/client-side-ajax-applications-in_3617.html">part three</a>.  Also notice the JavaScript string concatenation inside the binding.  You can put in any JavaScript in there that you like.  So now if you manually set X and Y values in SharePoint for a card the card shows in the right place.  But we're still missing the ability to drag cards.</p>

<p><b>Making Cards Draggable with jQuery</b></p>

<p>In order to enable dragging support you're supposed to call the draggable() function on the DOM elements you want to make draggable.  Simple right?  You just call $(".userstorycard").draggable() which should find every element with a class of userstorycard and call draggable() on it.</p>

<p>But if you do this onLoad() then ASP.Net AJAX Templating engine hasn't had a chance to render the new DOM elements yet.  Fortunately the DataView has the JavaScript equivalent of an OnRendered event that you can tie into:</p>

<p><span style="font-size:9.5pt;line-height:115%;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;color:blue;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA">function</span><span style="font-size:9.5pt;line-height:115%;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA"> onLoad() {<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>dataContext = $create(<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Sys.Data.AdoNetDataContext,  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{ serviceUri:  <span style="color:maroon">&quot;/demoprep/_vti_bin/ListData.svc&quot;</span> }<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>);<br />  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>dataView = $create(<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Sys.UI.DataView,<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>autoFetch:  <span style="color:blue">true</span>,<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>dataProvider: dataContext,<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>fetchOperation:  <span style="color:maroon">&quot;UserStories&quot;</span>,<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>fetchParameters: { $top: 20 }<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>},<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span>rendered: onRendered<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>},<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span><span style="color:blue">null</span>,<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>$get(<span style="color:maroon">&#39;userStories&#39;</span>)<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>);<br />  }<br />  <br />  <span style="color:blue">function</span> onRendered() {<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:darkgreen">// from   http://jqueryui.com/demos/draggable/<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>$(<span style="color:maroon">&quot;.userstorycard&quot;</span>).draggable();<br />  }</span></p>

<p>And that's it for enabling dragging.  Pretty simple.  The result looks like this:</p>

<p><a href="http://1.bp.blogspot.com/_gez10dNhuPk/S8C5Crk0xAI/AAAAAAAABss/y3vsN5TbKQA/s1600/part4-1-screenshot.jpg"><img style="cursor:pointer; cursor:hand;width: 400px; height: 334px;" src="http://1.bp.blogspot.com/_gez10dNhuPk/S8C5Crk0xAI/AAAAAAAABss/y3vsN5TbKQA/s400/part4-1-screenshot.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5458566204081095682" /></a></p>

<p>Ok, well you can't see the dragging support, but it's there, trust me.  And it's pretty cool except for one thing.</p>

<p><b>Saving Non-Visible Properties</b></p>

<p>The problem is that every time you refresh the page the nice layout you've done disappears and everything goes back to being stacked one on top of the other in the upper left.  My first thought was to create input type=hidden form elements on the page.  This approach causes a lot more plumbing code than is necessary.  The better way is that you can access the underlying in-memory JSON objects.  Step one is to register an "event" for when the user stops dragging a card.</p>

<p><span style="font-size:9.5pt;line-height:115%;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;color:blue;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA">function</span><span style="font-size:9.5pt;line-height:115%;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA"> onRendered() {<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:darkgreen">// from   http://jqueryui.com/demos/draggable/<br />  </span><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>$(<span style="color:maroon">&quot;.userstorycard&quot;</span>).draggable({<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span>stop: onDragStop<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>});<br />  }</span></p>

<p>Once you wire that up the onDragStop() function is where all the interesting stuff happens:</p>

<p><span style="font-size:9.5pt;line-height:115%;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;color:blue;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA">function</span><span style="font-size:9.5pt;line-height:115%;font-family:Consolas;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Consolas;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA"> onDragStop(event, ui) {<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:blue">var</span>   userStoryCard = ui.helper[0];<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:blue">var</span>   selectedUserStoryJsonObject =  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;</span>dataView.findContext(userStoryCard).dataItem;<br />  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:blue">var</span>   newX = ui.position.left;<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span><span style="color:blue">var</span>   newY = ui.position.top;<br />  <br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  Sys.Observer.setValue(selectedUserStoryJsonObject, <span style="color:maroon">  &quot;X&quot;</span>, newX);<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>  Sys.Observer.setValue(selectedUserStoryJsonObject, <span style="color:maroon">  &quot;Y&quot;</span>, newY);<br />  <span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>dataContext.saveChanges();<br />  }</span></p>

<p>The first line gets the DOM element that just the user just completed dragging.  The second line retrieves the in memory JSON object represented by that DOM element.  The next couple of lines get the X and Y that the user story card was dragged to relative to their parent DOM element.  And then something odd happens.</p>

<p>Sys.Observer.setValue looks so complicated.  Why couldn't we just call selectedUserStoryJsonObject.X = newX?</p>

<p>Well, if we'd done that the DataView wouldn't know about the change we just made.  If we then tried to call dataContext.saveChanges() nothing would get sent back to the server.  <a href=" http://msdn.microsoft.com/en-us/library/dd393596%28VS.100%29.aspx">Sys.Observer.setValue</a> notifies any interested parties, in this case the DataView, that a value has been changed.  And this enables the functionality we saw in <a href="">part two</a> where the DataView only sends the relevant records back to SharePoint instead of the entire set of JSON objects.</p>

<p>And so, with this code in place, we can now move user story cards around on the page and when we refresh the page or come back days later our layout has persisted back into SharePoint.</p>

<p><b>Conclusion</b></p>

<p>In this post you've seen how to directly modify the in-memory JSON objects and send them back to SharePoint.  Our application is finally getting interesting and I find it quite remarkable how little code it's taken.  In the next post I'll show how to do master-detail scenario's for editing user story cards.</p> 
